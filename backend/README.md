# GFW Check Backend

FastAPI backend server for checking if websites are blocked by the Great Firewall of China.

This server is designed to run on a machine in Mainland China, otherwise it would be pointless.

## Setup

1. Create a Python virtual environment:
   ```bash
   python3 -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

3. Run the server:
   ```bash
   python app/main.py
   ```

The API will be available at `http://localhost:8000`

## API Endpoints

### `GET /`
Health check endpoint.

**Response:**
```json
{
  "message": "GFW Check API",
  "version": "1.0.0"
}
```

### `GET /health`
Server health check.

**Response:**
```json
{
  "status": "ok"
}
```

### `POST /check?url=<url>`
Check if a URL is blocked by GFW.

**Parameters:**
- `url` (query string): The URL to check (e.g., `https://google.com` or `google.com`)

**Response:**
```json
{
  "url": "https://google.com",
  "blocked": false,
  "status_code": 200,
  "error": null,
  "timestamp": "2024-01-01T12:00:00Z"
}
```

**Response fields:**
- `url`: The normalized URL that was checked
- `blocked`: Boolean indicating if the URL is blocked by GFW
- `status_code`: HTTP status code (null if timeout/connection error)
- `error`: Error message if applicable (e.g., "Connection timeout", "Connection refused")
- `timestamp`: ISO 8601 timestamp of when the check was performed

**Error responses (400):**
```json
{
  "detail": "Invalid URL format. Please provide a valid URL (e.g., https://google.com)"
}
```

## How It Works

The backend uses `httpx` async HTTP client to attempt connection to URLs with a 10-second timeout:

1. **Accessible**: If the request completes successfully (any 2xx-5xx response), the site is marked as accessible
2. **Timeout**: If the request times out after 10 seconds, it's likely blocked (GFW drops connections)
3. **Connection Error**: If connection is refused, it's blocked
4. **Read Error**: If connection is reset mid-request, it's likely blocked

## Running with Uvicorn

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

For production deployment:
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 4
```

## Configuration

### Environment Variables
Create a `.env` file in the root directory:

```
# Backend port (default: 8000)
PORT=8000

# Request timeout in seconds (default: 10)
CHECK_TIMEOUT=10
```

### Constants
Edit `app/main.py` to adjust:
- `CHECK_TIMEOUT`: Request timeout (default 10 seconds)
- `USER_AGENT`: HTTP User-Agent header

## Logging

The application logs all check requests and any errors to stdout. Monitor logs for:
- `INFO`: Successful checks
- `WARNING`: Blocked URLs or timeout issues
- `ERROR`: Unexpected errors

## Future Enhancements

- [ ] Add caching for repeated checks
- [ ] Add rate limiting
- [ ] Add request validation
- [ ] Add database for storing check history
- [ ] Add statistical analysis of blocked sites
- [ ] Add DNS resolution checking
- [ ] Add TLS/SSL certificate validation
- [ ] Add tests


THIS README IS GENERATED BY GITHUB COPILOT